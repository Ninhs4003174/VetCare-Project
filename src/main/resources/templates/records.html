<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Pet Records</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <!-- jsPDF Library (CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <header>
        <nav>
            <ul class="navbar-menu">
                <li><a href="index.html"><img src="img/logo.png" alt="Logo" class="logo"></a></li>
                <li><a th:href="@{/records}">Pet Records</a></li>
                <li><a href="appointments.html">Appointments</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="profile.html">My Profile</a></li>
                <li><a href="#"><img src="img/notif.png" alt="Notifications" class="notification-icon"></a></li>
                <li><a href="logout.html" class="btn-secondary">Log out</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <section class="pet-records">
            <h1>Pet Medical Records</h1>

            <!-- Button to create a new record -->
            <div class="new-record-btn">
                <a th:href="@{/records/new}" class="btn-primary">Create New Record</a>
            </div>

            <!-- Dynamic records loaded via Thymeleaf -->
            <div th:each="record : ${records}" class="record-card">
                <div class="record-header">
                    <h2 th:text="${record.name} + ' Medical Record'"></h2>
                    <div class="action-buttons">
                        <!-- Dynamic edit and delete links using record.id -->
                        <a th:href="@{'/records/edit/' + ${record.id}}" class="btn-secondary">Edit Record</a>
                        <a th:href="@{'/records/delete/' + ${record.id}}" class="btn-danger" onclick="return confirm('Are you sure you want to delete this record?')">Delete Record</a>
                    </div>
                </div>
                <p><strong>Veterinarian:</strong> <span th:text="${record.veterinarian}"></span></p>
                <p><strong>Date of Birth:</strong> <span th:text="${record.dateOfBirth}"></span></p>
                <p><strong>Last Visit:</strong> <span th:text="${record.lastVisit}"></span></p>
                <p><strong>Allergies:</strong> <span th:text="${record.allergies}"></span></p>
                <p><strong>Prescriptions:</strong> <span th:text="${record.prescriptions}"></span></p>
                <p><strong>Vaccination History:</strong> <span th:text="${record.vaccinationHistory}"></span></p>
                <p><strong>Recent Tests:</strong> <span th:text="${record.recentTests}"></span></p>
                <p><strong>Recent Surgeries:</strong> <span th:text="${record.recentSurgeries}"></span></p>
                <p><strong>Dietary Recommendations:</strong> <span th:text="${record.dietaryRecommendations}"></span></p>
                <p><strong>Notes:</strong> <span th:text="${record.notes}"></span></p>
                
                <!-- Button to download the record as a PDF -->
                <button class="btn-primary" onclick="downloadRecordPDF(this)">Download Full Record</button>
            </div>

        </section>
    </main>

    <!-- JavaScript to handle PDF generation -->
    <script>
        function downloadRecordPDF(button) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get the pet record details from the DOM
            const recordCard = button.closest('.record-card');
            const petName = recordCard.querySelector('h2').textContent;
            const veterinarian = recordCard.querySelector('p:nth-child(2) span').textContent;
            const dateOfBirth = recordCard.querySelector('p:nth-child(3) span').textContent;
            const lastVisit = recordCard.querySelector('p:nth-child(4) span').textContent;
            const allergies = recordCard.querySelector('p:nth-child(5) span').textContent;
            const prescriptions = recordCard.querySelector('p:nth-child(6) span').textContent;
            const vaccinationHistory = recordCard.querySelector('p:nth-child(7) span').textContent;
            const recentTests = recordCard.querySelector('p:nth-child(8) span').textContent;
            const recentSurgeries = recordCard.querySelector('p:nth-child(9) span').textContent;
            const dietaryRecommendations = recordCard.querySelector('p:nth-child(10) span').textContent;
            const notes = recordCard.querySelector('p:nth-child(11) span').textContent;

            // Add the text content to the PDF
            doc.text(petName, 10, 10);
            doc.text(`Veterinarian: ${veterinarian}`, 10, 20);
            doc.text(`Date of Birth: ${dateOfBirth}`, 10, 30);
            doc.text(`Last Visit: ${lastVisit}`, 10, 40);
            doc.text(`Allergies: ${allergies}`, 10, 50);
            doc.text(`Prescriptions: ${prescriptions}`, 10, 60);
            doc.text(`Vaccination History: ${vaccinationHistory}`, 10, 70);
            doc.text(`Recent Tests: ${recentTests}`, 10, 80);
            doc.text(`Recent Surgeries: ${recentSurgeries}`, 10, 90);
            doc.text(`Dietary Recommendations: ${dietaryRecommendations}`, 10, 100);
            doc.text(`Notes: ${notes}`, 10, 110);

            // Save the generated PDF
            doc.save(`${petName}-Record.pdf`);
        }
    </script>
</body>
</html>
